<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Log in</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
</head>
<body>
    <div class="container max-w-lg mx-auto pt-10 pb-4 px-4">
      <div class="inline-block align-middle relative w-full text-left bg-white shadow-md rounded p-5">
        <form class="form-signin">
                <div id="error_message" style="display: none" class="h3 mb-3 alert alert-danger"></div>
                <div id="success_message" style="display: none" class="h3 mb-3 alert alert-success"></div>
          <h1 class="title text-xl font-bold mb-4">  Sign In</h1>
          <div class="mb-6">
                <label class="sr-only" for="inlineFormInputGroup">Email</label>
                  <input type="email" class=" mt-2 shadow appearance-none border rounded inline-block align-middle w-full  p-2 text-xs sm:text-base text-grey-darker leading-tight focus:outline-none focus:shadow-outline" id="inlineFormInputGroup" placeholder="Email">
            </div>
        <div class="text-right">
          <button id="submit" class="mb-6 bg-black hover:bg-grey-darkest text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="send()">Save</button>
        </div>
        </form>
      
        

        <button class="underline hover:no-underline text-sm text-grey-darker cursor-pointer" onclick="firstTimeHere()">First time here?</button>
      </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script>

function firstTimeHere(){
    window.location.href="http://127.0.0.1:8000/registerAttempt.html"
}        

function send() {
    if ((document.getElementById('inlineFormInputGroup').value == '')||(!document.getElementById('inlineFormInputGroup').value.includes('@'))) {
        document.getElementById('error_message').innerHTML = "Invalid Email Passed"
        throw "Validation Error"
    }
    fetch("http://127.0.0.1:8081/login",{
        method:"POST",
        body:JSON.stringify({
           email: document.getElementById('inlineFormInputGroup').value.replace(/<\/?[^>]+(>|$)/g, "")
        })
    }).then((r)=>{
        return r.json()
    }).then((r)=>{
        
        if (Cookies.get('key')) Cookies.remove('key')

        Cookies.set('key', JSON.stringify(r), { expires: r.expired_at });
        console.log(window.location.href.split('?')[1])
        window.location.href = window.location.href.split('?')[1]
    }).catch((e)=>{
        return e.json()
    }).then((e)=>{
                    document.getElementById("error_message").style.cssText="display:block"
                    document.getElementById("error_message").firstChild.innerHTML = e
        setTimeout(()=>{
                 window.location.href = "http://127.0.0.1:8000/registerAttempt.html"
        }, 3000)
    })
}
      </script>

</body>
</html>