<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Log in</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
</head>
<body>
    <div class="container max-w-lg mx-auto pt-10 pb-4 px-4">
      <div class="inline-block align-middle relative w-full text-left bg-white shadow-md rounded p-5">
        <form class="form-signin">
                <div id="error_message" style="display: none; color:red" class="h3 mb-3 alert alert-danger"></div>
                <div id="success_message" style="display: none; color:green" class="h3 mb-3 alert alert-success"></div>
          <h1 class="title text-xl font-bold mb-4">  Sign In</h1>
          <div class="mb-6">
                <label class="sr-only" for="inlineFormInputGroup">Email</label>
                  <input type="email" class=" mt-2 shadow appearance-none border rounded inline-block align-middle w-full  p-2 text-xs sm:text-base text-grey-darker leading-tight focus:outline-none focus:shadow-outline" id="inlineFormInputGroup" placeholder="Email">
            </div>
        <div class="text-right">
          <button id="submit" class="mb-6 bg-black hover:bg-grey-darkest text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="send()">Save</button>
        </div>
        </form>
      
        

        <button class="underline hover:no-underline text-sm text-grey-darker cursor-pointer" onclick="firstTimeHere()">First time here?</button>
      </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script>

function firstTimeHere(){
    window.location.href="http://127.0.0.1:8000/registerAttempt.html"
}        

function showSome(id, message) {
        document.getElementById(id).innerHTML = message
        document.getElementById(id).style.cssText="display:block"
        setTimeout(function(){
            document.getElementById(id).style.cssText="display:none"
        }, 2000)
}

async function send() {
    if ((document.getElementById('inlineFormInputGroup').value == '')||(!document.getElementById('inlineFormInputGroup').value.includes('@'))) {
        showSome('error_message', "Invalid Email Passed")
        throw "Invalid Email Passed"
    }
    fetch("http://127.0.0.1:8081/login", {
           method: 'POST',
           headers: {
               'Accept': 'application/json'
           },
           mode: 'cors',
           credentials: "same-origin",
           body: JSON.stringify({
            creds:{
                email: document.getElementById('inlineFormInputGroup').value
            }
           })
       })
       .then((r)=>{
          return r.text()
       })
       .then((r)=>{
            if (JSON.parse(r).error) {
                showSome('error_message', JSON.parse(r).error)
                setTimeout(()=>{
                    window.location.href = "http://localhost:8080/registerAttempt.html"
                }, 1500)
            }else{
                showSome('success_message', "OK")
                // redirect on index of app
            }
       }).catch((res)=>{
           console.log('CLIENT FETCH ERROR')
       });
}
      </script>

</body>
</html>